# DISABLED on 2025-11-02: Frontend Cloud Build/Run disabled; kept for reference only.
substitutions:
  _REPO: omni-ultra
  _IMAGE: omni-frontend
  _REGION: europe-west1
  _PROJECT_ID: refined-graph-471712-n9
  _TAG: v1.0.0
  _VITE_API_URL: https://omni-ultra-backend-prod-661612368188.europe-west1.run.app
  _VITE_WS_URL: wss://omni-ultra-backend-prod-661612368188.europe-west1.run.app

steps:
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-f'
      - 'frontend/Dockerfile'
      - '-t'
      - 'europe-west1-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/${_IMAGE}:${_TAG}'
      - '--build-arg'
      - 'VITE_API_URL=${_VITE_API_URL}'
      - '--build-arg'
      - 'VITE_WS_URL=${_VITE_WS_URL}'
      - 'frontend'

  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'push'
      - 'europe-west1-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/${_IMAGE}:${_TAG}'

  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args:
      - run
      - deploy
      - omni-frontend
      - --image=europe-west1-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/${_IMAGE}:${_TAG}
      - --region=${_REGION}
      - --platform=managed
      - --allow-unauthenticated
      - --port=8080

images:
  - 'europe-west1-docker.pkg.dev/${_PROJECT_ID}/${_REPO}/${_IMAGE}:${_TAG}'

options:
  machineType: 'E2_HIGHCPU_8'
  diskSizeGb: '50'

timeout: 3600s
