<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omni Dashboard - AI Chat Generator</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
        }
        .container { background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 90%; max-width: 800px; height: 80vh; display: flex; flex-direction: column; overflow: hidden; }
        .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; text-align: center; position: relative; }
        .nav-links { position: absolute; top: 10px; right: 20px; display: flex; gap: 15px; }
        .nav-link { color: white; text-decoration: none; padding: 8px 16px; border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; transition: all 0.3s; font-size: 0.9rem; }
        .nav-link:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.6); }
        .header h1 { font-size: 2rem; margin-bottom: 10px; }
        .provider-selector { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .provider-btn { background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: all 0.3s ease; }
        .provider-btn:hover, .provider-btn.active { background: rgba(255,255,255,0.3); border-color: rgba(255,255,255,0.6); }
        .env-panel { margin-top: 12px; display: flex; justify-content: center; align-items: center; gap: 8px; flex-wrap: wrap; }
        .env-input { padding: 6px 10px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.6); min-width: 260px; }
        .env-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5); color: white; padding: 6px 12px; border-radius: 8px; cursor: pointer; }
        .health-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; background: #bbb; border: 1px solid rgba(255,255,255,0.6); }
        .chat-area { flex: 1; padding: 20px; overflow-y: auto; background: #f8f9fa; }
        .message { margin-bottom: 15px; padding: 15px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
        .user-message { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-left: auto; }
        .ai-message { background: white; border: 1px solid #e9ecef; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-area { padding: 20px; background: white; border-top: 1px solid #e9ecef; display: flex; gap: 10px; }
        .message-input { flex: 1; padding: 15px; border: 2px solid #e9ecef; border-radius: 25px; font-size: 16px; outline: none; transition: border-color 0.3s ease; }
        .message-input:focus { border-color: #667eea; }
        .send-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 25px; border-radius: 25px; cursor: pointer; font-size: 16px; transition: transform 0.2s ease; }
        .send-btn:hover { transform: translateY(-2px); }
        .send-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .loading { display: none; text-align: center; padding: 20px; color: #666; }
        .status { padding: 10px 20px; background: #e3f2fd; border-left: 4px solid #2196f3; margin: 10px 0; border-radius: 0 10px 10px 0; }
    </style>
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="OMNI Platform ‚Äî Multi‚ÄëAI orodja s skupnim API.">
    <meta property="og:title" content="OMNI Platform ‚Äî Multi‚ÄëAI Orchestration">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=OMNI+Platform">
    <meta name="twitter:card" content="summary_large_image">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="nav-links">
          <a href="landing.html" class="nav-link">üè† Domov</a>
          <a href="omni-dashboard.html" class="nav-link">üß† Omni Dashboard</a>
          <a href="dashboard.html" class="nav-link">üë§ Profil</a>
          <a href="landing.html#pricing" class="nav-link">üí∞ Cenik</a>
        </div>
        <h1>üöÄ Omni Dashboard</h1>
        <p>AI Chat Generator - Veƒç providerjev, en vmesnik</p>
        <div class="provider-selector">
          <button class="provider-btn active" data-provider="auto">Auto</button>
          <button class="provider-btn" data-provider="openai">OpenAI</button>
          <button class="provider-btn" data-provider="gemini">Gemini</button>
          <button class="provider-btn" data-provider="vertex">Vertex AI</button>
        </div>
        <div class="env-panel">
          <span>API:</span>
          <input id="apiBaseInput" class="env-input" placeholder="http://localhost:3002" />
          <button id="saveApiBtn" class="env-btn">Shrani</button>
          <span title="Backend zdravje" id="healthDot" class="health-dot"></span>
        </div>
      </div>

      <div class="chat-area" id="chatArea">
        <div class="status">
          <strong>Sistem pripravljen!</strong> Izberite provider in zaƒçnite klepetati.
        </div>
      </div>

      <div class="loading" id="loading"><p>ü§ñ AI razmi≈°lja...</p></div>

      <div class="input-area">
        <input type="text" class="message-input" id="messageInput" placeholder="Vnesite va≈°e sporoƒçilo..." />
        <button class="send-btn" id="sendBtn">Po≈°lji</button>
      </div>
    </div>

    <script src="/env.js"></script>
    <script type="text/babel" data-presets="env">
      let currentProvider = 'auto';
      const DEFAULT_API = 'http://localhost:3002';
      function getBackendUrl() {
        return (window.localStorage.getItem('omniApiBase') || window.OMNI_API_BASE || DEFAULT_API);
      }
      let backendUrl = getBackendUrl();

      // Provider selection
      document.querySelectorAll('.provider-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.provider-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentProvider = btn.dataset.provider;
          addMessage('system', `Provider spremenjen na: ${currentProvider.toUpperCase()}`);
        });
      });

      // Send message
      document.getElementById('sendBtn').addEventListener('click', sendMessage);
      document.getElementById('messageInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

      async function sendMessage() {
        const input = document.getElementById('messageInput');
        const message = input.value.trim();
        if (!message) return;

        addMessage('user', message);
        input.value = '';
        document.getElementById('loading').style.display = 'block';
        document.getElementById('sendBtn').disabled = true;

        try {
          const payload = { message, provider: currentProvider };
          const resp = await fetch(`${backendUrl}/api/ai-chat`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
          });
          const data = await resp.json().catch(() => ({}));
          if (resp.ok) {
            addMessage('ai', (data.response || data.text || '‚Äî'), (data.provider || currentProvider || 'AI'), data.model);
          } else {
            addMessage('error', `Napaka: ${data.error || data.detail || resp.status}`);
          }
        } catch (error) {
          addMessage('error', `Napaka pri povezavi: ${error.message}`);
        } finally {
          document.getElementById('loading').style.display = 'none';
          document.getElementById('sendBtn').disabled = false;
        }
      }

      function addMessage(type, content, provider = null, model = null) {
        const chatArea = document.getElementById('chatArea');
        const messageDiv = document.createElement('div');
        if (type === 'user') {
          messageDiv.className = 'message user-message';
          messageDiv.textContent = content;
        } else if (type === 'ai') {
          messageDiv.className = 'message ai-message';
          messageDiv.innerHTML = `
            <div style="margin-bottom: 10px;">
              <strong>ü§ñ ${provider?.toUpperCase() || 'AI'}</strong>
              ${model ? `<span style="color: #666; font-size: 0.9em;">(${model})</span>` : ''}
            </div>
            <div>${content}</div>
          `;
        } else if (type === 'system') {
          messageDiv.className = 'status';
          messageDiv.innerHTML = `<strong>‚ÑπÔ∏è ${content}</strong>`;
        } else if (type === 'error') {
          messageDiv.className = 'status';
          messageDiv.style.background = '#ffebee';
          messageDiv.style.borderColor = '#f44336';
          messageDiv.innerHTML = `<strong>‚ùå ${content}</strong>`;
        }
        chatArea.appendChild(messageDiv);
        chatArea.scrollTop = chatArea.scrollHeight;
      }

      function setHealthDot(ok) { const dot = document.getElementById('healthDot'); if (dot) dot.style.background = ok ? '#2ecc71' : '#e74c3c'; }
      async function checkHealth(showMessage = true) {
        try {
          const r = await fetch(`${backendUrl}/health`, { method: 'GET' });
          const d = await r.json().catch(() => ({}));
          setHealthDot(r.ok);
          if (showMessage) {
            if (r.ok) addMessage('system', `Backend povezan! Status: ${d.status || 'healthy'}`);
            else addMessage('error', 'Backend ni dosegljiv');
          }
          return r.ok;
        } catch (e) { setHealthDot(false); if (showMessage) addMessage('error', `Backend ni dosegljiv: ${e.message}`); return false; }
      }

      function initApiControls() {
        const input = document.getElementById('apiBaseInput');
        const btn = document.getElementById('saveApiBtn');
        if (input) input.value = backendUrl;
        if (btn) btn.addEventListener('click', () => {
          const val = (input?.value || '').trim();
          if (val) { window.localStorage.setItem('omniApiBase', val); backendUrl = val; addMessage('system', `API posodobljen: ${val}`); checkHealth(false); }
        });
      }

      window.addEventListener('load', async () => { initApiControls(); await checkHealth(true); setInterval(() => checkHealth(false), 15000); });
    </script>
  </body>
</html>