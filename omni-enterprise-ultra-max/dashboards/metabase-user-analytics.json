{
  "name": "User Analytics & Engagement Dashboard",
  "description": "User behavior, engagement metrics, and churn prediction insights",
  "cards": [
    {
      "name": "Active Users (30 Days)",
      "type": "scalar",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT COUNT(DISTINCT user_id) as active_users FROM user_events WHERE created_at >= NOW() - INTERVAL '30 days'"
        }
      },
      "visualization": {
        "type": "scalar",
        "settings": {
          "trend": {
            "query": "SELECT COUNT(DISTINCT user_id) as active_users FROM user_events WHERE created_at >= NOW() - INTERVAL '60 days' AND created_at < NOW() - INTERVAL '30 days'"
          }
        }
      }
    },
    {
      "name": "New Signups (30 Days)",
      "type": "scalar",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT COUNT(*) as new_users FROM users WHERE created_at >= NOW() - INTERVAL '30 days'"
        }
      }
    },
    {
      "name": "User Growth Trend",
      "type": "timeseries",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT DATE_TRUNC('day', created_at) as date, COUNT(*) as new_users FROM users WHERE created_at >= NOW() - INTERVAL '90 days' GROUP BY DATE_TRUNC('day', created_at) ORDER BY date"
        }
      },
      "visualization": {
        "type": "line",
        "settings": {
          "series": [{"name": "New Users", "color": "#88BF4D"}],
          "cumulative": false
        }
      }
    },
    {
      "name": "User Engagement Score",
      "type": "gauge",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT AVG(engagement_score) as avg_engagement FROM user_metrics WHERE calculated_at >= NOW() - INTERVAL '7 days'"
        }
      },
      "visualization": {
        "type": "gauge",
        "settings": {
          "min": 0,
          "max": 100,
          "ranges": [
            {"from": 0, "to": 40, "color": "#EF8C8C", "label": "Low"},
            {"from": 40, "to": 70, "color": "#F9CF48", "label": "Medium"},
            {"from": 70, "to": 100, "color": "#88BF4D", "label": "High"}
          ]
        }
      }
    },
    {
      "name": "Churn Risk Distribution",
      "type": "categorical",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT churn_risk_level, COUNT(*) as user_count FROM ai_churn_predictions WHERE prediction_date >= NOW() - INTERVAL '7 days' GROUP BY churn_risk_level ORDER BY CASE churn_risk_level WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 END"
        }
      },
      "visualization": {
        "type": "bar",
        "settings": {
          "colors": {
            "critical": "#DC267F",
            "high": "#FE6100",
            "medium": "#F9CF48",
            "low": "#88BF4D"
          },
          "orientation": "horizontal"
        }
      }
    },
    {
      "name": "High Churn Risk Users",
      "type": "table",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT u.email, u.company_name, p.churn_probability, p.churn_risk_level, p.engagement_score, p.recommended_actions, p.prediction_date FROM ai_churn_predictions p JOIN users u ON p.user_id = u.id WHERE p.churn_risk_level IN ('critical', 'high') AND p.prediction_date >= NOW() - INTERVAL '7 days' ORDER BY p.churn_probability DESC LIMIT 50"
        }
      },
      "visualization": {
        "type": "table",
        "settings": {
          "columns": {
            "churn_probability": {"format": "percent", "decimals": 1},
            "engagement_score": {"format": "decimal", "decimals": 1},
            "churn_risk_level": {
              "conditional_formatting": {
                "critical": {"color": "#DC267F", "bold": true},
                "high": {"color": "#FE6100", "bold": true}
              }
            }
          }
        }
      }
    },
    {
      "name": "Feature Usage Heatmap",
      "type": "heatmap",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT feature_name, DATE_TRUNC('day', created_at) as date, COUNT(*) as usage_count FROM user_events WHERE event_type = 'feature_used' AND created_at >= NOW() - INTERVAL '30 days' GROUP BY feature_name, DATE_TRUNC('day', created_at) ORDER BY date, feature_name"
        }
      },
      "visualization": {
        "type": "heatmap",
        "settings": {
          "color_scale": ["#E8F4F8", "#509EE3", "#004D7A"]
        }
      }
    },
    {
      "name": "User Retention Cohorts",
      "type": "table",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "WITH cohorts AS (SELECT user_id, DATE_TRUNC('month', created_at) as cohort_month FROM users), activity AS (SELECT DISTINCT user_id, DATE_TRUNC('month', created_at) as activity_month FROM user_events) SELECT c.cohort_month, COUNT(DISTINCT c.user_id) as cohort_size, COUNT(DISTINCT CASE WHEN DATE_TRUNC('month', a.activity_month) = c.cohort_month THEN a.user_id END) as month_0, COUNT(DISTINCT CASE WHEN a.activity_month = c.cohort_month + INTERVAL '1 month' THEN a.user_id END) as month_1, COUNT(DISTINCT CASE WHEN a.activity_month = c.cohort_month + INTERVAL '2 months' THEN a.user_id END) as month_2, COUNT(DISTINCT CASE WHEN a.activity_month = c.cohort_month + INTERVAL '3 months' THEN a.user_id END) as month_3 FROM cohorts c LEFT JOIN activity a ON c.user_id = a.user_id WHERE c.cohort_month >= NOW() - INTERVAL '12 months' GROUP BY c.cohort_month ORDER BY c.cohort_month DESC"
        }
      },
      "visualization": {
        "type": "table",
        "settings": {
          "columns": {
            "cohort_month": {"date_format": "MMM YYYY"},
            "month_0": {"format": "percent_of_cohort"},
            "month_1": {"format": "percent_of_cohort"},
            "month_2": {"format": "percent_of_cohort"},
            "month_3": {"format": "percent_of_cohort"}
          }
        }
      }
    },
    {
      "name": "User Lifetime Value Prediction",
      "type": "scatter",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT u.id, u.email, p.lifetime_value_prediction, EXTRACT(EPOCH FROM (NOW() - u.created_at))/86400 as days_since_signup, p.engagement_score FROM ai_churn_predictions p JOIN users u ON p.user_id = u.id WHERE p.prediction_date >= NOW() - INTERVAL '7 days' LIMIT 500"
        }
      },
      "visualization": {
        "type": "scatter",
        "settings": {
          "x_axis": "days_since_signup",
          "y_axis": "lifetime_value_prediction",
          "color_by": "engagement_score"
        }
      }
    }
  ],
  "filters": [
    {
      "name": "Date Range",
      "type": "date",
      "default": "past30days"
    },
    {
      "name": "Churn Risk Level",
      "type": "category",
      "options": ["all", "critical", "high", "medium", "low"]
    },
    {
      "name": "User Segment",
      "type": "category",
      "options": ["all", "enterprise", "pro", "free"]
    }
  ],
  "layout": {
    "grid": [
      {"x": 0, "y": 0, "w": 3, "h": 2, "card": "Active Users (30 Days)"},
      {"x": 3, "y": 0, "w": 3, "h": 2, "card": "New Signups (30 Days)"},
      {"x": 6, "y": 0, "w": 3, "h": 2, "card": "User Engagement Score"},
      {"x": 9, "y": 0, "w": 3, "h": 2, "card": "Churn Risk Distribution"},
      {"x": 0, "y": 2, "w": 6, "h": 4, "card": "User Growth Trend"},
      {"x": 6, "y": 2, "w": 6, "h": 4, "card": "Feature Usage Heatmap"},
      {"x": 0, "y": 6, "w": 12, "h": 5, "card": "High Churn Risk Users"},
      {"x": 0, "y": 11, "w": 12, "h": 4, "card": "User Retention Cohorts"},
      {"x": 0, "y": 15, "w": 12, "h": 4, "card": "User Lifetime Value Prediction"}
    ]
  }
}
