name: Create Phase Issues

on:
  workflow_dispatch:

jobs:
  create:
    name: Create missing Phase issues (1–10)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Phase Issues
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const phases = [
              { n:1,  t:'Foundations & Architecture (4-6h)' },
              { n:2,  t:'Backend & AI/ML (50+ endpoints) (8-12h)' },
              { n:3,  t:'Gateway & API Security (6-8h)' },
              { n:4,  t:'Local Development Setup (2-3h)' },
              { n:5,  t:'Cloud Run Production (3-4h)' },
              { n:6,  t:'Monitoring & Grafana (4-6h)' },
              { n:7,  t:'Advanced AI/ML (10-14h)' },
              { n:8,  t:'Business Logic & Payments (8-10h)' },
              { n:9,  t:'Security & Compliance (6-8h)' },
              { n:10, t:'Dashboards & CI/CD (10-12h)' }
            ];

            const { owner, repo } = context.repo;
            const existing = await github.paginate(github.rest.issues.listForRepo, {
              owner, repo, state: 'open', per_page: 100
            });
            const titles = new Set(existing.map(i => i.title));

            for (const p of phases) {
              const title = `Phase ${p.n}: ${p.t}`;
              if (titles.has(title)) {
                core.notice(`Skip (exists): ${title}`);
                continue;
              }

              const body = (
                `## ✨ Kompletan Learning Program – Phase ${p.n}\n\n` +
                `Referenčni issues: #25, #26\n\n` +
                `Opis:\n` +
                `- Ta issue pokriva fazo "${p.t}" iz profesionalnega 10-faznega učnega programa.\n\n` +
                `Naloge:\n` +
                `- [ ] Preglej specifikacije in obstoječo kodo v repozitoriju\n` +
                `- [ ] Pripravi načrt izvedbe in kriterije sprejema\n` +
                `- [ ] Implementiraj spremembe v ustreznih modulih (backend/gateway/frontend)\n` +
                `- [ ] Posodobi dokumentacijo (README, Guides)\n` +
                `- [ ] Dodaj povezave na PR-je, teste in dashboarde\n\n` +
                `Kriteriji sprejema:\n` +
                `- Build in testi pretečejo (CI)\n` +
                `- Dokumentacija posodobljena in sklicuje #25 ter #26\n` +
                `- Vse naloge označene kot dokončane\n`
              );

              await github.rest.issues.create({ owner, repo, title, body, labels: ['dokumentacija','phase'] });
              core.info(`Created: ${title}`);
            }