# OMNI Platform Mosquitto Configuration
# Secure MQTT broker configuration for device communications

# Basic configuration
pid_file /var/run/mosquitto.pid
persistence true
persistence_location /var/lib/mosquitto/
log_dest file /var/log/mosquitto/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information

# Security settings
allow_anonymous false
password_file /etc/mosquitto/passwd

# TLS/SSL configuration
cafile /etc/mosquitto/ca_certificates/ca.crt
certfile /etc/mosquitto/certs/server.crt
keyfile /etc/mosquitto/certs/server.key
tls_version tlsv1.2
require_certificate false

# Listener configuration
listener 1883
protocol mqtt

listener 8883
protocol mqtt
cafile /etc/mosquitto/ca_certificates/ca.crt
certfile /etc/mosquitto/certs/server.crt
keyfile /etc/mosquitto/certs/server.key
tls_version tlsv1.2
require_certificate false

# WebSocket listener for browser connections
listener 9001
protocol websockets
cafile /etc/mosquitto/ca_certificates/ca.crt
certfile /etc/mosquitto/certs/server.crt
keyfile /etc/mosquitto/certs/server.key

# Connection settings
max_connections -1
max_inflight_messages 100
max_queued_messages 2000

# Message settings
message_size_limit 268435456
autosave_interval 1800

# Topic restrictions for security
acl_file /etc/mosquitto/acl

# Bridge settings (for connecting to other brokers if needed)
# connection omni-cloud
# address cloud.omni-platform.com:8883
# topic # both 2 omni/ omni/
# start_type automatic
# restart_timeout 10

# Plugin configuration (for additional features)
# plugin /usr/lib/mosquitto/mosquitto_auth_plugin.so
# plugin_opt_anon_allow false

# Logging for debugging (remove in production)
# log_type debug