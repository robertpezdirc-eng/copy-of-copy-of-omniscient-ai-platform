{
  "name": "Revenue Analytics Dashboard",
  "description": "Comprehensive revenue tracking, forecasting, and growth metrics",
  "cards": [
    {
      "name": "Total Revenue (30 Days)",
      "type": "scalar",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT SUM(amount) as total_revenue FROM transactions WHERE created_at >= NOW() - INTERVAL '30 days' AND status = 'completed'"
        }
      },
      "visualization": {
        "type": "scalar",
        "settings": {
          "currency": "EUR",
          "compact_numbers": true
        }
      }
    },
    {
      "name": "Revenue Trend (90 Days)",
      "type": "timeseries",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT DATE_TRUNC('day', created_at) as date, SUM(amount) as daily_revenue FROM transactions WHERE created_at >= NOW() - INTERVAL '90 days' AND status = 'completed' GROUP BY DATE_TRUNC('day', created_at) ORDER BY date"
        }
      },
      "visualization": {
        "type": "line",
        "settings": {
          "series": [{"name": "Daily Revenue", "color": "#509EE3"}],
          "goal": {"value": 10000, "label": "Daily Target"}
        }
      }
    },
    {
      "name": "Revenue by Payment Method",
      "type": "categorical",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT payment_method, SUM(amount) as revenue, COUNT(*) as transactions FROM transactions WHERE created_at >= NOW() - INTERVAL '30 days' AND status = 'completed' GROUP BY payment_method ORDER BY revenue DESC"
        }
      },
      "visualization": {
        "type": "pie",
        "settings": {
          "colors": {
            "stripe": "#635BFF",
            "paypal": "#00457C",
            "crypto": "#F7931A"
          }
        }
      }
    },
    {
      "name": "MRR (Monthly Recurring Revenue)",
      "type": "scalar",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT SUM(subscription_amount) as mrr FROM subscriptions WHERE status = 'active' AND billing_cycle = 'monthly'"
        }
      },
      "visualization": {
        "type": "scalar",
        "settings": {
          "currency": "EUR",
          "prefix": "â‚¬",
          "trend": {
            "query": "SELECT SUM(subscription_amount) as mrr FROM subscriptions WHERE status = 'active' AND billing_cycle = 'monthly' AND updated_at >= NOW() - INTERVAL '30 days'"
          }
        }
      }
    },
    {
      "name": "ARR (Annual Recurring Revenue)",
      "type": "scalar",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT (SUM(CASE WHEN billing_cycle = 'monthly' THEN subscription_amount * 12 WHEN billing_cycle = 'yearly' THEN subscription_amount ELSE 0 END)) as arr FROM subscriptions WHERE status = 'active'"
        }
      },
      "visualization": {
        "type": "scalar",
        "settings": {
          "currency": "EUR",
          "compact_numbers": true
        }
      }
    },
    {
      "name": "Revenue Forecast (AI-Powered)",
      "type": "timeseries",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT prediction_date as date, predicted_revenue, lower_bound, upper_bound FROM ai_revenue_forecasts WHERE tenant_id = {{tenant_id}} AND prediction_date >= NOW() ORDER BY prediction_date LIMIT 30"
        },
        "parameters": [
          {"name": "tenant_id", "type": "text", "default": "default"}
        ]
      },
      "visualization": {
        "type": "line",
        "settings": {
          "series": [
            {"name": "Predicted Revenue", "color": "#509EE3"},
            {"name": "Lower Bound", "color": "#98D9C2", "style": "dashed"},
            {"name": "Upper Bound", "color": "#98D9C2", "style": "dashed"}
          ]
        }
      }
    },
    {
      "name": "Top Revenue Sources",
      "type": "table",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT u.email as customer, u.company_name, SUM(t.amount) as total_revenue, COUNT(t.id) as transaction_count, MAX(t.created_at) as last_transaction FROM transactions t JOIN users u ON t.user_id = u.id WHERE t.created_at >= NOW() - INTERVAL '90 days' AND t.status = 'completed' GROUP BY u.id, u.email, u.company_name ORDER BY total_revenue DESC LIMIT 20"
        }
      },
      "visualization": {
        "type": "table",
        "settings": {
          "columns": {
            "total_revenue": {"currency": "EUR"},
            "last_transaction": {"date_format": "YYYY-MM-DD"}
          }
        }
      }
    },
    {
      "name": "Churn Impact on Revenue",
      "type": "timeseries",
      "query": {
        "database": "omni_db",
        "type": "native",
        "native": {
          "query": "SELECT DATE_TRUNC('month', cancelled_at) as month, SUM(subscription_amount) as churned_mrr, COUNT(*) as churned_count FROM subscriptions WHERE status = 'cancelled' AND cancelled_at >= NOW() - INTERVAL '12 months' GROUP BY DATE_TRUNC('month', cancelled_at) ORDER BY month"
        }
      },
      "visualization": {
        "type": "bar",
        "settings": {
          "colors": ["#EF8C8C"],
          "stacking": false
        }
      }
    }
  ],
  "filters": [
    {
      "name": "Date Range",
      "type": "date",
      "default": "past30days"
    },
    {
      "name": "Tenant",
      "type": "text",
      "default": "default"
    },
    {
      "name": "Payment Method",
      "type": "category",
      "options": ["all", "stripe", "paypal", "crypto"]
    }
  ],
  "layout": {
    "grid": [
      {"x": 0, "y": 0, "w": 4, "h": 2, "card": "Total Revenue (30 Days)"},
      {"x": 4, "y": 0, "w": 4, "h": 2, "card": "MRR (Monthly Recurring Revenue)"},
      {"x": 8, "y": 0, "w": 4, "h": 2, "card": "ARR (Annual Recurring Revenue)"},
      {"x": 0, "y": 2, "w": 8, "h": 4, "card": "Revenue Trend (90 Days)"},
      {"x": 8, "y": 2, "w": 4, "h": 4, "card": "Revenue by Payment Method"},
      {"x": 0, "y": 6, "w": 12, "h": 4, "card": "Revenue Forecast (AI-Powered)"},
      {"x": 0, "y": 10, "w": 8, "h": 4, "card": "Top Revenue Sources"},
      {"x": 8, "y": 10, "w": 4, "h": 4, "card": "Churn Impact on Revenue"}
    ]
  }
}
